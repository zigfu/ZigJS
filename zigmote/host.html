<html>
<head>
<title>Host o'mercy</title>

<script src="/socket.io/socket.io.js"></script>
<script src="/synclist-client.js"></script>
<script src="/zigmote-client.js"></script>
<script src="/zigmote.cursor.js"></script>

<script>

var host;
var roomShared;
var userslist;

var cursor;

function getRoomId() {
	var roomid = localStorage.getItem("zigmoteHostId");
	if (null == roomid) {
		roomid = Math.floor(Math.random() * 1000000);
		localStorage.setItem("zigmoteHostId", roomid);
	}
	return roomid;
}

function getRoomName() {
	var roomname = localStorage.getItem("zigmoteHostName");
	if (null == roomname) {
		roomname = "[Unnamed TV]";
		localStorage.setItem("zigmoteHostName", roomname);
	}
	return roomname;
}

function setStatus(status) {
	document.getElementById('status').innerHTML = status;
}

cursors = {}
function cursorcallback(x, y, relative, userid) {
	if (relative) {
		// something 
	}

	//positionInParent(cursors[userid].cursor, x, y);
}

function loaded() {
	socket = io.connect('http://'+document.location.hostname);
	socket.on('connect', function () {
		host = zigmote.host(socket);
		host.startRoom(getRoomId(), getRoomName(), function(roomdata) {
			roomShared = synclist.subscribe(socket, roomdata.roomsharedid);
			roomShared.bind(document.getElementById("roomdetails"));

			userslist = synclist.subscribe(socket, roomdata.userslistid);
			userslist.bind(document.getElementById("userslist"));
			userslist.onadd = function(userid, userdata) {
				cursors[userid] = {};
			}
			userslist.onremove = function(userid) {
				delete cursors[userid];
			}

			cursor = zigmotecursor.host(host);
			cursor.oncursorlock = function(userid) { console.log("Cursor locked by userid " + userid);}
			cursor.oncursorunlock = function(userid) { console.log("Cursor unlocked by userid " + userid);}

			cursor.onorientation = function(alpha, beta, gamma, userid) {
				console.log("Alpha: " + alpha + "   Beta: " + beta + "   Gamma: " + gamma);

			}

			setStatus("Connected");
		});

		socket.on('disconnect', function() {
			setStatus("Disconnected");
		});

		
	});
}

document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);


</script>

</head>
<body>

<div id="status">Connecting...</div>

users:
<ul id="userslist">
</ul>

roomdetails:
<ul id="roomdetails">
</ul>


</body>
</html>
