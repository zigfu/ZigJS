<html>
<head>
	<script src='zig.js'></script>


<script>

var radar;

function loaded() {
	radar = (function(parent, userClass) {
		var parentElement = parent;
		var users = [];

		function onnewuser(newUser) {
			var el = document.createElement('div');
			el.classList.add(userClass);
			users[newUser.id] = el;
			parentElement.appendChild(el);
		}

		function onlostuser(lostUser) {
			parentElement.removeChild(users[lostUser.id]);
			delete users[lostUser.id];
		}

		function ondataupdate(trackedUsers) {
			for (var userid in trackedUsers) {
				var currUser = trackedUsers[userid];
				var el = users[currUser.id];
				var pos = currUser.position;
				el.style.left = (((pos[0] / 4000) + 0.5) * parentElement.offsetWidth - (el.offsetWidth / 2)) + "px";
				el.style.top = ((pos[2] / 4000.0) * parentElement.offsetHeight - (el.offsetHeight / 2)) + "px";
			}				
		}

		return {
			onnewuser : onnewuser,
			onlostuser : onlostuser, 
			ondataupdate : ondataupdate,
		}
	}(document.getElementById("radar"), "user"));
}

document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false); 

function ZigPluginLoaded() {
	zig.init(document.getElementById("ZigPlugin"));


	var fader = zig.Fader(0, 300);
	//fader.addEventListener('valuechange', function(value) {console.log(value);});
	
	var pushdetector = zig.PushDetector();
	pushdetector.addEventListener('push', function() { console.log('Push'); });
	pushdetector.addEventListener('release', function() { console.log('Release'); });
	pushdetector.addEventListener('click', function() { console.log('Click'); });

	var swipeDetector = zig.SwipeDetector();
	swipeDetector.addEventListener('swipe', function(dir) { console.log('Swipe: ' + dir); });

	/*var crap = zig.EngageUsersWithSkeleton(1);
	
	var hsd = zig.HandSessionDetector();
	hsd.addListener(fader);*/

	var crap = zig.EngageFirstUserInSession();
	crap.addListener(fader);
	crap.addListener(pushdetector);
	crap.addListener(swipeDetector);

	crap.addEventListener('userengaged', function(user) {
		console.log("User engaged");
		//user.addListener(hsd);
	});
	crap.addEventListener('userdisengaged', function(user) {
		console.log('User disengaged');
		//user.removeListener(hsd);
	});
	crap.addEventListener('allusersengaged', function(allUsers) {
		console.log('All users engaged: ' + allUsers.length);
	});

	crap.addEventListener('sessionstart', function(fp) {
		console.log("Session start");
	});
	crap.addEventListener('sessionupdate', function(p) {
		//console.log("Update: " + p);
	})
	crap.addEventListener('sessionend', function() {
		console.log("Session end");
	});

	zig.addListener(crap);

	//zig.addListener(radar);

	//zig.addEventListener('newuser', function(newUser) {})
}

</script>


</head>
<body>


<div id="radar"></div>

<div id="pluginContainer">
	<object id="ZigPlugin" type="application/x-zig" width="0" height="0">
		<param name="onload" value="ZigPluginLoaded" />
	</object>
</div> 


</body>
</html>