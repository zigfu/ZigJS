<!DOCTYPE html>
<html>
<head>

<link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>
<link href='css/style.css' rel='stylesheet' type='text/css' />
<!--
<script src='js/less.js' type='text/javascript'></script>
-->
<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js' type='text/javascript'></script>

<script src="http://zig.tv/socket.io/socket.io.js"></script>
<script src="js/synclist-client.js"></script>
<script src="js/zigmote-client.js"></script>
<script src="js/zigmote.cursor.js"></script>

<!-- ZigJS -->
<script type="text/javascript" src="zig.js"></script>

<script type='text/javascript'>

images = [
	{
		'name': 'tube',
		'description' : 'Youtube Player',
		'default_image': 'img/youtube_but.png',
		'highlit_image': 'img/youtube_buthvr.png'
	}, 
	{
		'name': 'muse',
		'description' : 'Music Player',
		'default_image': 'img/muse_but.png',
		'highlit_image': 'img/muse_buthvr.png'
	}, 
	{
		'name': 'games',
		'description' : 'Sample Games',
		'default_image': 'img/games_but.png',
		'highlit_image': 'img/games_buthvr.png'
	}, 
	{
		'name': 'slid',
		'description' : 'Slide Viewer',
		'default_image': 'img/slide_but.png',
		'highlit_image': 'img/slide_buthvr.png'
	}
];

function getRoomName() {
	var roomname = localStorage.getItem("zigmoteHostName");
	if (null == roomname) {
		roomname = "[My TV]";
		localStorage.setItem("zigmoteHostName", roomname);
	}
	return roomname;
}

function roomStarted(roomData) {
	// TODO: bind user list

	// cursor stuff
	host.cursor.oncursorlock = function(userid) { onSessionStart();}
	host.cursor.oncursorunlock = function(userid) { onSessionEnd();}
	host.cursor.oncursor = function(x,y,rel,userid) {
		sliderTarget = x;
	}
}

var socket;
var host;

$(document).ready( function () {
	lis = $('div.butholder ul li a');

	lis.each(function (index, element) {
		$(element).hover(function() { hoverEnter(index, element) },
						 function() { hoverLeave(index, element) });
	});

	// connect to zigtv
	socket = io.connect('http://zig.tv');
	socket.on('connect', function () {
		// connected
		host = zigmote.host(socket);
		host.startRoom("motionosdemos", getRoomName(), roomStarted);
	});

	socket.on('disconnect', function() {
		// disconnected
	});
});

function hoverEnter(index, element) {
	img = $(element).find('img');
	img.attr('src', images[index]['highlit_image']);
}

function hoverLeave(index, element) {
	img = $(element).find('img');
	img.attr('src', images[index]['default_image']);
}
lastHighlighted = -1;

pushDetector = new Zig.PushDetector();
pushDetector.onClick = function() {
	console.log("Push detector: click " + lastHighlighted);
	if (lastHighlighted == -1) return;
	window.location = lis.eq(lastHighlighted).attr('href');
}

horizontalFader = new Zig.Fader(Zig.OrientationX, 300);
horizontalFader.itemsCount = 4;
horizontalFader.onItemSelected = function(itemIndex) {
	lastHighlighted = itemIndex;
	hoverEnter(itemIndex, lis.eq(itemIndex));
};

horizontalFader.onItemUnselected = function(itemIndex) {
	lastHighlighted = -1;
	hoverLeave(itemIndex, lis.eq(itemIndex));
};
horizontalFader.onValueChange = function(value)
{
	//element = document.getElementById("slider_nub");
	//element.style.left = (value * element.parentNode.offsetWidth - (element.offsetWidth / 2)) + "px";
	sliderTarget = value;
}

isInSession = false;
function onSessionStart()
{
	isInSession = true;
	$(".showinsession").fadeIn();
}

function onSessionEnd()
{
	isInSession = false;
	$(".showinsession").fadeOut();
} 

function ZigPluginLoaded() {
	Zig.init(document.getElementById("ZigPlugin"));
	Zig.SingleUser.controls.AddControl(horizontalFader);
	Zig.SingleUser.controls.AddControl(pushDetector);

	var radar = new Zig.TopDownUsersRadar(document.getElementById("usersRadar"), "user");
	Zig.SingleUser.onUserEngaged = function(user) { onSessionStart(); radar.DoUserEngaged(user); };
	Zig.SingleUser.onUserDisengaged = function(user) { onSessionEnd(); radar.DoUserDisengaged(user) };
	Zig.listeners.push(radar);

	document.getElementById('ver').innerHTML = document.getElementById("ZigPlugin").version ;
	sliderNub = document.getElementById("slider_nub");
	renderInterval = setInterval(updateSlider, 1/60 * 1000)
}

sliderTarget = 0.5;
sliderCurrent = 0.5;

function lerp(from, to, amount) 
{
	return from + ((to - from) * amount);
}

function updateSlider()
{
	if (!isInSession) return;
	
	sliderCurrent = lerp(sliderCurrent, sliderTarget, 0.5);
	sliderNub.style.left = (sliderCurrent * sliderNub.parentNode.offsetWidth - (sliderNub.offsetWidth / 2)) + "px";
}
/*---------------------------------------
PreLoader for Icons
---------------------------------------*/
function preloader() 
{
hoverImages = new Image(); 
hoverImages.src = "img/youtube_buthvr.png";
hoverImages.src = "img/muse_buthvr.png";
hoverImages.src = "img/games_buthvr.png";
hoverImages.src = "img/slide_buthvr.png";
}


</script>

<style>

.slider {
	width: 940px;
	height: 15px;
	margin: 0px auto;
	background-color: #9ca6ac;
	border-radius: 3px;
	-moz-border-radius: 3px;
	-webkit-border-radius: 3px;
	box-shadow:inset 0px 1px 5px #000;
	-moz-box-shadow:inset 0px 1px 5px #000;
	-webkit-box-shadow:inset 0px 1px 5px #000;
	-o-box-shadow:inset 0px 1px 5px #000;
}

.slider_nub {
	width: 20px;
	height: 15px;
	background-color: #151b23;
	position: relative;
	border-radius: 3px;
	-moz-border-radius: 3px;
	-webkit-border-radius: 3px;
	box-shadow: 0px 1px 5px #000;
	-moz-box-shadow: 0px 1px 5px #000;
	-webkit-box-shadow: 0px 1px 5px #000;
	-o-box-shadow: 0px 1px 8px #000;
}

.showinsession {
	display: none
}

#usersRadar	{
	width: 	300px;
	height: 300px;
	border-radius: 15px;
	margin-top: 100px;
	margin-left: 70%;
	background:url('img/radar.png'); 
	overflow:hidden;
	position: fixed;
}

#usersRadar .user {
	width:	35px;
	height: 35px;
	background-image: url(http://motionos.com/zigjs/beta/i/user_img_na.png);
	position:relative;
}

#usersRadar .user.active {
	background-image: url(http://motionos.com/zigjs/beta/i/user_img.png);
	position: relative;
}
</style>

</head>
<body onLoad="javascript:preloader();">

<div id='wrapper'>

	<div id='header'>
		<div class='row'>
			<div class='left'>
				<img src='img/logo.png' alt='' />
			</div>
			<div class='right'>
				<div style='text-align: center'>
					<h1>DEMO</h1>
				</div>
			</div>
		</div>
	</div>
	
	<div id='gallery'>
		<div class='butholder'>
			<ul>
				<li><a href="youtube/index.html"><img name='tube' src='img/youtube_but.png' alt=''/></a></li>
				<li><a href="C:\Users\Bryce\ZigJS\musicv3\index_host.html"><img name='muse' src='img/muse_but.png' alt='' /></a></li>
				<li><a href="unitysamples/index.html"><img name='games' src='img/games_but.png' alt=''/></a></li>
				<li><a href="#"><img name='slid' src='img/slide_but.png' alt='' /></a></li>
			</ul>
			<div style="height:15px">
				<div class="slider showinsession" id="slider">
					<div class="slider_nub showinsession" id="slider_nub"></div>
				</div>
			</div>
		</div>
	</div>
	
	<div id='content'>
		<div id="usersRadar"></div>
	</div>
	
	<div id='footer'>
       		<p>ver - <span id="ver"><em>[ZigJS Not Installed]</em></span></p>
    		<center><img src="img/powered.png" /></center>
		 
	</div>
	
</div>


<div id="pluginContainer">
	<object id="ZigPlugin" type="application/x-zig" width="0" height="0">
		<param name="onload" value="ZigPluginLoaded" />
	</object>
</div>

</body>
</html>