<html>
  <head>

  <link href='css/style.css' rel='stylesheet' type='text/css' />

    <script src="http://zig.tv/socket.io/socket.io.js"></script>
    <script src="js/synclist-client.js"></script>
    <script src="js/zigmote-client.js"></script>
    <script src="js/zigmote.cursor.js"></script>
    <script type="text/javascript" src="js/iscroll.js"></script>

    <style>

    #wrapper {
      width : 100%;
      height : 100%;
    }

    body {
    }

    </style>

    <script>

var currentRoomName = localStorage.getItem("currentRoomName");
if (null == currentRoomName) currentRoomName = "[ZigFu Demo]";  

function nameentry() {
    document.getElementById("currentRoomName").style.display = "none";
    document.getElementById("currentRoomNameInput").style.display = "block";
    document.getElementById("currentRoomNameInput").focus();
}

function nameentrydone() {
    var newName = document.getElementById("currentRoomNameInput").value;
    nameChanged(newName);
}

function nameChanged(newName) {
  if (newName == "") newName = "[NonameTV]";
    currentRoomName = newName;
    localStorage.setItem("currentRoomName", currentRoomName);
    document.getElementById("currentRoomNameInput").value = currentRoomName;
    document.getElementById("currentRoomName").innerHTML = currentRoomName;
    document.getElementById("currentRoomName").style.display = "block";
    document.getElementById("currentRoomNameInput").style.display = "none";
    if (undefined !== host) {
      host.rename(currentRoomName);
    }
}

function showModal(elementId) {
  document.getElementById('mask').style.display = 'block';
  document.getElementById(elementId).style.display = 'block';
}

function hideModal(e) {
  document.getElementById('mask').style.display = 'none';
  var dialogs = document.querySelectorAll(".modaldialog");
  for (var i=0; i<dialogs.length;i++) dialogs[i].style.display = 'none';
  e.stopPropagation();
}

function youtubeSearchResult(result) {
  var data = result.data;
  for(var i = 0; i < data.items.length; i++) {
    videolist.add(data.items[i].title);
  }
}

function doyoutubeSearch(query) {
  videolist.clear();
  var s = document.createElement('script');
  s.src = "http://gdata.youtube.com/feeds/api/videos?v=2&alt=jsonc&callback=youtubeSearchResult&q=" + query;
  document.body.appendChild(s); //ajax it!
  document.getElementById("title").innerHTML = "Results for: "+query;
}

var socket;
var host;
var videolistscroller;
var videolist;

function roomStarted(roomData) {
  videolist = synclist.subscribe(socket, roomData.roomid + ":videolist");
  videolist.bind(document.getElementById('videolist'), function(id, data) {
    var l = document.createElement('li');
    l.innerHTML = data;
    return l;
  });
  videolist.onadd = function() { videolistscroller.refresh();}

  host.on('doSearch', function(data) {
      doyoutubeSearch(data.query);
    });
}

function loaded() {
  nameChanged(currentRoomName);

  // connect to zigtv
  socket = io.connect('http://zig.tv');
  socket.on('connect', function () {
    host = zigmote.host(socket);
    host.startRoom("motionosdemos", currentRoomName, roomStarted);
  });

  socket.on('disconnect', function() {
    console.log("Disconnected from zig.tv");
    // disconnected
  });

  videolistscroller = new iScroll('videolistScroller');


  document.getElementById('mask').addEventListener('click', hideModal, false);
  //document.addEventListener('click', function() { showModal('searchbox');}, false);
}

document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);


    </script>

  </head>

  <body>

  <div id="wrapper">

    <div id='header'>
        <div class='row'>
          <div class='left'>
            <img src='img/logo.png' alt='' />
          </div>
          <div class='right'>
            <div style='float : right'>
              <h1 id="currentRoomName" onClick="nameentry();" class="nameentry">[Room Name]</h1>

                <input class="nameentry" style="display:none; margin-top: 20px; " type="text" placeholder="[Enter TV Name]" spellcheck="off" 
                autocomplete="off" id="currentRoomNameInput" name="currentRoomNameInput" onChange="nameentrydone()"/>
            </div>
          </div>
        </div>
      </div>

   <div id='gallery'> 
    <div id='title'>Title 2</div>
    <div id='mainarea'>
      <div id='videolistScroller'><ul id='videolist'></ul></div>
    </div>

     <div id='mask'></div>
     <div id='searchbox' class='modaldialog'>
        <div class='modaldialogcontents'>
          <input type='text'><div id='searchbutton'>Search</div>
        </div>
     </div>
   </div>
  </div>

  </body>
</html>