<!DOCTYPE html>
<html>
<head>

<link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>

	<link href='css/style.css' rel='stylesheet' type='text/css' />

    <link href="slide/common.css" rel="stylesheet" media="screen" />
    <link href="slide/default.css" rel="stylesheet" class="theme" />


<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js' type='text/javascript'></script>

<script src="http://zig.tv/socket.io/socket.io.js"></script>
<script src="js/synclist-client.js"></script>
<script src="js/zigmote-client.js"></script>
<script src="js/zigmote.cursor.js"></script>

<script type='text/javascript'>

var currentRoomName = localStorage.getItem("currentRoomName");
if (null == currentRoomName) currentRoomName = "[ZigFu Demo]";	


var lastCursor = {x : 0, y : 0};

function clamp(val, min, max) {
	if (val < min) return min;
	if (val > max) return max;
	return val;
}


function moveCursorBy(element, deltaX, deltaY) {
	lastCursor.x = clamp(lastCursor.x + deltaX, 0, element.parentNode.offsetWidth);
	lastCursor.y = clamp(lastCursor.y + deltaY, 0, element.parentNode.offsetHeight);

	setCursor(element, lastCursor.x, lastCursor.y);
}


function setCursor(element, xpx, ypx) {
	element.style.left = lastCursor.x + "px";
	element.style.top = lastCursor.y + "px";
}

var cursorrel;

function roomStarted(roomData) {
	// TODO: bind user list

	// cursor stuff
	host.cursor.oncursorlock = function(userid) { onSessionStart();}
	host.cursor.oncursorunlock = function(userid) { onSessionEnd();}
	host.cursor.oncursor = (function(cursorElement) { return function(x,y,rel,userid) {
		cursorrel = rel;
		if (rel) {
			moveCursorBy(cursorElement, x, y);
		} else {
			horizontalFader.setValue(x);
		}
	}}) (document.getElementById("realcursor"));
	host.cursor.onclick = function(userid) {
		console.log('click');
		if (rel) {
			var x = parseInt(document.getElementById("realcursor").style.left);
			var y =	parseInt(document.getElementById("realcursor").style.top);
			var elt = document.elementFromPoint(x,y-1); //subtract one to get the thing cursor points to
			var evt = document.createEvent("MouseEvents");
    		evt.initMouseEvent("click", true, true, window, 1, x, y, x, y,
        			false, false, false, false, 0, null);
			elt.dispatchEvent(evt);
		} else {
			pushDetector.onClick();			
		}
	}
}

var socket;
var host;

$(document).ready( function () {
	// connect to zigtv
	socket = io.connect('http://zig.tv');
	socket.on('connect', function () {
		// connected
		host = zigmote.host(socket);
		host.startRoom("template", currentRoomName, roomStarted);
	});

	socket.on('disconnect', function() {
		// disconnected
	});

	nameChanged(currentRoomName);
});

isInSession = false;
function onSessionStart()
{
	isInSession = true;
	$(".showinsession").fadeIn();
}

function onSessionEnd()
{
	isInSession = false;
	$(".showinsession").fadeOut();
	hoverLeaveAll();
} 

function nameentry() {
    document.getElementById("currentRoomName").style.display = "none";
    document.getElementById("currentRoomNameInput").style.display = "block";
    document.getElementById("currentRoomNameInput").focus();
}

function nameentrydone() {
    var newName = document.getElementById("currentRoomNameInput").value;
    nameChanged(newName);
}

function nameChanged(newName) {
	if (newName == "") newName = "[NonameTV]";
    currentRoomName = newName;
    localStorage.setItem("currentRoomName", currentRoomName);
    document.getElementById("currentRoomNameInput").value = currentRoomName;
    document.getElementById("currentRoomName").innerHTML = currentRoomName;
    document.getElementById("currentRoomName").style.display = "block";
    document.getElementById("currentRoomNameInput").style.display = "none";
    if (undefined !== host) {
    	host.rename(currentRoomName);
    }
}



</script>

<style>

.showinsession {
	display: none
}

#realcursor {
	width : 28;
	height : 35;
	position:absolute;
	background-image : url("img/hand-pointer.png");
}

</style>

</head>
<body>

<div id='wrapper'>
<!--
	<div id='header'>
		<div class='row'>
			<div class='left'>
				<img src='img/logo.png' alt='' />
			</div>
			<div class='right'>
				<div style='float : right'>
					<h1 id="currentRoomName" onClick="nameentry();" class="nameentry">[Room Name]</h1>

    				<input class="nameentry" style="display:none; margin-top: 20px; " type="text" placeholder="[Enter TV Name]" spellcheck="off" 
    				autocomplete="off" id="currentRoomNameInput" name="currentRoomNameInput" onChange="nameentrydone()"/>
				</div>
			</div>
		</div>
	</div>
	-->

	<!--<div id='gallery'>-->

 	<div class="presentation">
      <div id="presentation-counter">Loading...</div>
      <div class="slides">

        <div class="slide" id="landing-slide">
          <section class="middle">
            <h1>Landing slide</h1>
          </section>
        </div>

        <div class="slide" id="slide1">
          <section class="middle">
            <h1>Slide 1</h1>
          </section>
        </div>

        <div class="slide" id="slide2">
          <section class="middle">
            <h1>Slide 2</h1>
          </section>
        </div>

        <div class="slide" id="slide3">
          <section class="middle">
            <h1>Slide 3</h1>
          </section>
        </div>

        <div class="slide" id="slide4">
          <section class="middle">
            <h1>Slide 4</h1>
          </section>
        </div>

        <div class="slide" id="slide5">
          <section class="middle">
            <h1>Slide 5</h1>
          </section>
        </div>


      </div> <!-- slides -->
      <div id="speaker-note" class="invisible" style="display: none;">
      </div> <!-- speaker note -->
    </div> <!-- presentation -->

		
	<!--</div>--> <!-- gallery -->
	
	
	
	
</div>

<div id="realcursor" class="showinsession">
</div>

<script src="slide/slide.js"></script>

</body>
</html>