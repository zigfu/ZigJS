<html>
<head>
<title>Host o'mercy</title>

<script src="/socket.io/socket.io.js"></script>
<script src="/synclist-client.js"></script>
<script src="/zigmote-client.js"></script>

<script>

var host;
var roomdetails;
var userslist;

function getRoomId() {
	var roomid = localStorage.getItem("zigmoteHostId");
	if (null == roomid) {
		roomid = Math.floor(Math.random() * 1000000);
		localStorage.setItem("zigmoteHostId", roomid);
	}
	return roomid;
}

function getRoomName() {
	var roomname = localStorage.getItem("zigmoteHostName");
	if (null == roomname) {
		roomname = "[Unnamed TV]";
		localStorage.setItem("zigmoteHostName", roomname);
	}
	return roomname;
}

function setStatus(status) {
	document.getElementById('status').innerHTML = status;
}

function loaded() {
	socket = io.connect('http://'+document.location.hostname);
	socket.on('connect', function () {
		host = zigmote.host(socket);
		host.startRoom(getRoomId(), getRoomName(), function(roomid, roomdataid) {
			roomdetails = synclist.subscribe(socket, roomdataid);
			roomdetails.bind(document.getElementById("roomdetails"));
			roomdetails.onadd = function(id, data) {
				if ("userslist" == id) {
					userslist = synclist.subscribe(socket, roomdetails.get("userslist"));
					userslist.bind(document.getElementById("userslist"));
				}
			}
			setStatus("Connected");
		});

		socket.on('disconnect', function() {
			setStatus("Disconnected");
		});
	});
}

document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);


</script>

</head>
<body>

<div id="status">Connecting...</div>

users:
<ul id="userslist">
</ul>

roomdetails:
<ul id="roomdetails">
</ul>


</body>
</html>
